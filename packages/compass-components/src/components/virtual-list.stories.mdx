import { Meta, Story, Controls } from '@storybook/blocks';
import { VirtualList } from './virtual-list';
import { spacing } from '@leafygreen-ui/tokens';

<Meta
  title="Components/Virtualization/VirtualList"
  component={VirtualList}
  parameters={{ layout: 'centered' }}
  argTypes={{
    overScanCount: {
      control: 'number',
      description:
        'Number of items to keep rendered outside of the visible viewport',
    },
    rowGap: {
      control: 'number',
      description: 'Space in pixels between list items',
    },
  }}
/>

# VirtualList

The VirtualList component provides efficient rendering of large lists by only rendering items that are visible in the viewport.

## Usage

```tsx
import { VirtualList } from './virtual-list';

// Basic usage
<VirtualList
  items={items}
  renderItem={(item, ref) => (
    <Card ref={ref}>
      <h3>{item.title}</h3>
      <p>{item.content}</p>
    </Card>
  )}
  estimateItemInitialHeight={() => 80}
  overScanCount={5}
  rowGap={0}
/>

// With custom heights
<VirtualList
  items={items}
  renderItem={(item, ref) => (
    <Card ref={ref} style={{ height: item.id % 2 === 0 ? '120px' : '80px' }}>
      <h3>{item.title}</h3>
      <p>{item.content}</p>
    </Card>
  )}
  estimateItemInitialHeight={(item) => item.id % 2 === 0 ? 120 : 80}
  overScanCount={5}
  rowGap={8}
/>
```

## Examples

### Default

<Story name="Default">
  {() => {
    // Generate a list of items for demonstration
    const generateItems = (count) =>
      Array.from({ length: count }, (_, i) => ({
        id: i,
        title: `Item ${i + 1}`,
        content: `This is the content for item ${i + 1}`,
      }));

    const items = generateItems(1000);

    const ListItemComponent = ({ item, ref }) => (
      <div ref={ref} style={{ padding: `${spacing[200]}px 0` }}>
        <h3 style={{ margin: '0 0 8px 0' }}>{item.title}</h3>
        <p style={{ margin: 0 }}>{item.content}</p>
      </div>
    );

    const renderItem = (item, ref) => <ListItemComponent item={item} ref={ref} />;

    return (
      <div style={{ width: '400px', height: '600px', border: '1px solid #ccc' }}>
        <VirtualList
          items={items}
          renderItem={renderItem}
          estimateItemInitialHeight={() => 80}
          overScanCount={5}
          rowGap={spacing[200]}
        />
      </div>
    );

}}

</Story>

Default virtual list with fixed height items.

### With Gap

<Story name="WithGap">
  {() => {
    const generateItems = (count) =>
      Array.from({ length: count }, (_, i) => ({
        id: i,
        title: `Item ${i + 1}`,
        content: `This is the content for item ${i + 1}`,
      }));

    const items = generateItems(1000);

    const ListItemComponent = ({ item, ref }) => (
      <div ref={ref} style={{ padding: `${spacing[200]}px 0` }}>
        <h3 style={{ margin: '0 0 8px 0' }}>{item.title}</h3>
        <p style={{ margin: 0 }}>{item.content}</p>
      </div>
    );

    const renderItem = (item, ref) => <ListItemComponent item={item} ref={ref} />;

    return (
      <div style={{ width: '400px', height: '600px', border: '1px solid #ccc' }}>
        <VirtualList
          items={items}
          renderItem={renderItem}
          estimateItemInitialHeight={() => 80}
          overScanCount={5}
          rowGap={spacing[200]}
        />
      </div>
    );

}}

</Story>

Virtual list with gap between items.

### With Custom Height

<Story name="WithCustomHeight">
  {() => {
    const generateItems = (count) =>
      Array.from({ length: count }, (_, i) => ({
        id: i,
        title: `Item ${i + 1}`,
        content: `This is the content for item ${i + 1}`,
      }));

    const items = generateItems(1000);

    const CustomHeightItem = ({ item, ref }) => (
      <div ref={ref} style={{ padding: `${spacing[200]}px 0`, height: item.id % 2 === 0 ? '120px' : '80px' }}>
        <h3 style={{ margin: '0 0 8px 0' }}>{item.title}</h3>
        <p style={{ margin: 0 }}>{item.content}</p>
      </div>
    );

    const renderCustomHeightItem = (item, ref) => (
      <CustomHeightItem item={item} ref={ref} />
    );

    return (
      <div style={{ width: '400px', height: '600px', border: '1px solid #ccc' }}>
        <VirtualList
          items={items}
          renderItem={renderCustomHeightItem}
          estimateItemInitialHeight={(item) => (item.id % 2 === 0 ? 120 : 80)}
          overScanCount={5}
          rowGap={spacing[200]}
        />
      </div>
    );

}}

</Story>

Virtual list with variable height items.

## Props

<Controls />
